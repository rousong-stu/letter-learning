# 系统配置模块开发计划

本文档面向 “配置” 菜单下的各子模块，明确功能范围、前后端对接范围、实施顺序、技术要点与交付标准。后续开发请严格按照阶段推进，完成一个阶段后再进入下一阶段。

## 1. 模块清单与目标

| 序号 | 模块 | 主要功能 |
| ---- | ---- | -------- |
| 1 | 个人中心 | 个人资料查看/编辑、头像上传、密码修改、登录设备/安全信息展示 |
| 2 | 用户管理 | 已完成第一版（账号增删改查、角色分配、邮箱必填） |
| 3 | 角色管理 | 角色增删改查、权限配置（定义可访问的大模块/菜单组）、分配给用户 |
| 4 | 菜单管理 | 菜单树维护、大模块/子菜单配置、与前端路由/权限联动 |
| 5 | 字典管理 | 业务枚举维护（字典分类+字典项）、提供统一查询接口 |
| 6 | 任务管理 | 任务列表、创建/指派、状态流转、记录任务日志 |
| 7 | 系统日志 | 登录日志、操作日志展示、搜索过滤 |
| - | 部门管理 | **取消**：从前端菜单中移除，不再提供接口 |

> 注：本计划不直接覆盖用户管理模块，但后续角色/菜单权限完成后需回头联调用户管理的角色赋权界面。

## 2. 整体时间线（迭代式）

| 阶段 | 目标模块 | 主要产出 | 预估工期 |
| ---- | -------- | -------- | -------- |
| A | 个人中心 | 个人资料 API、头像上传、密码修改、前端对接 + 测试 | 3~4 天 |
| B | 角色管理 | 角色 CRUD、权限矩阵设计（模块级）、与用户管理联动 | 4~5 天 |
| C | 菜单管理 | 菜单树数据模型、后台维护、前端动态菜单加载、权限校验 | 5 天 |
| D | 字典管理 | 字典分类/项维护、缓存策略、前端页面对接 | 3 天 |
| E | 任务管理 | 任务模型、指派流程、状态更新、前端页面对接 | 5 天 |
| F | 系统日志 | 日志写入钩子、查询接口、前端检索 | 4 天 |
| G | 收尾 | 部门管理下线、联调回归、补充文档与自动化测试 | 2 天 |

> 实际工期会根据需求调整。每阶段完成后需进行代码评审、测试、文档更新。

## 3. 详细规划

### 3.1 个人中心

- **后端**
  - 新建用户资料接口：查询当前登录用户基本信息、绑定邮箱/手机号、最近登录日志。
  - 编辑接口：允许修改昵称、性别、联系方式等字段，需权限校验（仅本人或管理员）。
  - 头像上传：引入文件上传端点，存储策略（本地 / OSS）待定；更新用户头像 URL。
  - 密码修改：旧密码验证 + 新密码强度校验 + 会话失效策略。
  - 安全日志：记录密码修改、头像修改、资料变更。
- **前端**
  - 表单与上传组件，调用真实接口。
  - 成功/失败提示、重新登录引导（密码修改）。
  - 兼容移动端视图。
- **测试**
  - 自动化覆盖资料查询、资料修改、密码修改、头像更新（模拟文件上传）。

### 3.2 角色管理

- **功能点**
  - 角色列表、创建、编辑、删除。
  - 权限模型：角色 → 菜单模块（大模块/页面）映射；管理员拥有全部权限且不可删除。
  - 与用户管理联动：用户编辑时选择角色，角色删除需校验是否被引用。
- **后端**
  - 角色表扩展（描述、是否系统）已具备，需新增权限关联表（角色-菜单/模块）。
  - 提供 CRUD 接口、权限分配接口。
  - 权限内置常量：枚举全站大模块。
- **前端**
  - 对接 `src/api/roleManagement`，实现角色表格、权限勾选组件（树或多选）。
  - 角色删除/禁用时的提示与联动。
- **测试**
  - 新建角色、分配权限、验证用户登录后菜单可见性；角色删除回归。

### 3.3 菜单管理

- **功能点**
  - 菜单树维护：名称、路由、图标、排序、是否显示等。
  - 菜单与权限绑定：提供层级结构供角色管理使用。
  - 前端根据登录用户权限动态加载菜单（替换当前 mock）。
- **后端**
  - 新建菜单表（支持多级节点、路由信息）。
  - CRUD 接口、菜单树接口。
  - 与角色权限表对接。
- **前端**
  - 调整动态路由加载逻辑，自后端获取菜单。
  - 菜单管理界面对接（拖拽、排序如模板所示）。
- **测试**
  - 菜单新增/编辑的接口测试，用户登录后菜单过滤逻辑测试。

### 3.4 字典管理

- **功能点**
  - 字典分类 + 字典项维护。
  - 提供缓存或内存映射以提升查询效率。
- **后端**
  - 建表：`dict_category`、`dict_item`。
  - CRUD 接口、根据分类查询接口。
  - 封装获取字典数据的公共方法，供其他模块调用。
- **前端**
  - 对接 `src/api/dictionaryManagement`。
  - 保持模板的分类列表 & 字典项表格交互。
- **测试**
  - API 单元测试、字典缓存命中测试。

### 3.5 任务管理

- **功能点**
  - 任务列表、创建、指派、状态流转（待办 / 进行中 / 已完成）、任务描述/备注。
- **后端**
  - 任务表、任务操作记录表。
  - CRUD、状态更新、指派 API。
  - 任务通知（后续可集成）。
- **前端**
  - `src/api/taskManagement` 对接，列表 + 表单 + 状态操作。
- **测试**
  - 任务创建、更新、指派流程测试。

### 3.6 系统日志

- **功能点**
  - 登录日志、操作日志展示。
- **后端**
  - 扩展 `audit_logs` 表用途，新增写入钩子（用户登录、关键操作）。
  - 提供查询接口（时间区间、用户、操作类型）。
- **前端**
  - 对接 `src/api/systemLog`，实现筛选、分页、详情查看。
- **测试**
  - 模拟登录、操作，验证日志记录与查询正确。

### 3.7 部门管理下线

- 移除前端菜单项与路由。
- 清理无用接口/mocks。
- 确认无页面引用部门数据。

---

## 4. 技术栈与约束

- 后端：FastAPI、SQLAlchemy 2 async、Alembic、Pydantic V2。
- 前端：Vue 3 + Pinia + Element Plus，保持模板风格。
- 文件上传：优先使用本地存储方案，后续可扩展 OSS。
- 权限控制：基于角色 → 菜单映射，前端 guard 使用角色 slug，后端在 `/userInfo` 返回菜单/角色信息。
- 所有新功能必须补充自动化测试（pytest-asyncio）。

---

## 5. 交付标准

1. 数据库迁移脚本：每个模块变更需新增 Alembic 迁移，确保 idempotent。
2. API 文档：在 `docs/` 目录增加对应模块的接口说明，或同步更新 `README`/Swagger。
3. 自动化测试：`poetry run pytest` 全部通过。
4. 前后端联调：页面操作顺畅，无 404/500，无控制台报错。
5. 部署验证：按《部署指南》在测试环境验证。
6. 文档更新：更新开发进度文档中的里程碑状态。

---

## 6. 下一步行动

1. 个人中心模块：准备 API 设计与数据库字段列表，完成后进入开发。
2. 角色/菜单权限模型：先确认大模块枚举，保证学生登录隐藏“配置”等模块。
3. 输入输出契约：整理 `src/api/*` 中各模块的请求/响应结构作为实现参考。
4. 阶段评审：每个模块完成后进行代码评审和测试结果汇报。

此计划将根据实际推进情况更新。如需求有变，请及时反馈以调整优先级。 

